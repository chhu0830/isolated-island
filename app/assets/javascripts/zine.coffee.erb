# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://coffeescript.org/

$(document).ready ->
  $('#banner-img').fadeIn 'slow'
  return

$(document).ready ->
  canvas = document.getElementById('canvas1')
  context = canvas.getContext('2d')
  img = new Image
  w = undefined
  h = undefined
  offset = undefined
  glitchInterval = undefined
  img.src = '<%= asset_path "article1" %>'

  img.onload = ->
    init()
    window.onresize = init
    return

  init = ->
    clearInterval glitchInterval
    canvas.width = w = 250
    offset = w * 0
    canvas.height = h = 250
    glitchInterval = setInterval((->
      clear()
      context.drawImage img, 0, 0, img.width, img.height, 0, 0, w, h
      setTimeout glitchImg, randInt(250, 1000)
      return
    ), 500)
    return

  clear = ->
    context.rect 0, 0, w, h
    context.fillStyle = 'black'
    context.fill()
    return

  glitchImg = ->
    i = 0
    while i < randInt(10, 20)
      x = Math.random() * w
      y = Math.random() * h
      spliceWidth = w - x
      spliceHeight = randInt(5, h / 3)
      context.drawImage canvas, 0, y, spliceWidth, spliceHeight, x, y, spliceWidth, spliceHeight
      context.drawImage canvas, spliceWidth, y, x, spliceHeight, 0, y, x, spliceHeight
      i++
    return

  randInt = (a, b) ->
    ~ ~(Math.random() * (b - a) + a)

  return

$(document).ready ->
  $(window).scroll ->
    if ($('nav').offset().top < $(window).height())
      $('a').css("color", "white")
      $('nav').css("background-color", "black")
    else
      $('a').css("color", "black")
      $('nav').css("background-color", "white")
    return

  return

$ ->
  $('#arrow').click ->
    $('html,body').animate { scrollTop: $('#article').offset().top }, 1600
    return
  return
